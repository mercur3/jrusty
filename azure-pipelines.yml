trigger:
  - master
pool:
  vmImage: ubuntu-latest
stages:
  - stage: Test
    jobs:
      - job: eclipse_temurin_17
        displayName: Test on Ubuntu with Eclipse Temurin 17
        container: eclipse-temurin:17-jdk-focal
        steps:
          - bash: |
              ./gradlew test
          - task: UseDotNet@2
            displayName: "Use .NET Core sdk"
            inputs:
              version: 6.0.x
              includePreviewVersions: true
          - task: PublishCodeCoverageResults@1
            displayName: "Code coverage"
            inputs:
              codeCoverageTool: "JaCoCo"
              summaryFileLocation: $(System.DefaultWorkingDirectory)/build/reports/jacoco/test/jacocoTestReport.xml
              reportDirectory: $(System.DefaultWorkingDirectory)/build/reports/jacoco/test/html
              #additionalCodeCoverageFiles: # Optional
              failIfCoverageEmpty: true
      - job: eclipse_temurin_18
        displayName: Test on Ubuntu with Eclipse Temurin 18
        container: eclipse-temurin:18-jdk-focal
        steps:
          - bash: |
              ./gradlew test
      - job: amazon_corretto_17
        displayName: Test on Amazon Corretto 17
        container: amazoncorretto:17
        steps:
          - bash: |
              ./gradlew test
      - job: amazon_correto_18
        displayName: Test on Amazon Corretto 18
        container: amazoncorretto:18
        steps:
          - bash: |
              ./gradlew test
